From 701ba7165d9b8265cb94a1aea6ab478271d6265f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zbigniew=20J=C4=99drzejewski-Szmek?= <zbyszek@in.waw.pl>
Date: Wed, 5 Jun 2013 20:33:42 -0400
Subject: [PATCH] journalctl: no color for --reboot-- when not on tty

(cherry picked from commit 3001c74580c1713bd634990a0b2ab351fdec7a98)
---
 src/journal/journalctl.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/journal/journalctl.c b/src/journal/journalctl.c
index 3e6817a581..c21182f2ac 100644
--- a/src/journal/journalctl.c
+++ b/src/journal/journalctl.c
@@ -1333,12 +1333,14 @@ int main(int argc, char *argv[]) {
 
                         if (!arg_merge) {
                                 sd_id128_t boot_id;
+                                const char *color_on = on_tty() ? ANSI_HIGHLIGHT_ON : "",
+                                           *color_off = on_tty() ? ANSI_HIGHLIGHT_OFF : "";
 
                                 r = sd_journal_get_monotonic_usec(j, NULL, &boot_id);
                                 if (r >= 0) {
                                         if (previous_boot_id_valid &&
                                             !sd_id128_equal(boot_id, previous_boot_id))
-                                                printf(ANSI_HIGHLIGHT_ON "-- Reboot --" ANSI_HIGHLIGHT_OFF "\n");
+                                                printf("%s-- Reboot --%s\n", color_on, color_off);
 
                                         previous_boot_id = boot_id;
                                         previous_boot_id_valid = true;
