From 23aabcca1dc3f166d724810ff834c34517595a65 Mon Sep 17 00:00:00 2001
From: Umut Tezduyar <umut@tezduyar.com>
Date: Wed, 23 Jan 2013 09:23:49 +0100
Subject: [PATCH] core: Set source for mountinfo .mount units (cherry picked
 from commit aa7cb2098302d45c8768ca08bf1e433a19aa46b9)

---
 src/core/mount.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/core/mount.c b/src/core/mount.c
index 5d2b010..4f3a6e4 100644
--- a/src/core/mount.c
+++ b/src/core/mount.c
@@ -1472,7 +1472,7 @@ static int mount_add_one(
         int r;
         Unit *u;
         bool delete;
-        char *e, *w = NULL, *o = NULL, *f = NULL;
+        char *e, *w = NULL, *o = NULL, *s = NULL, *f = NULL;
         MountParameters *p;
         bool load_extras = false;
 
@@ -1545,6 +1545,7 @@ static int mount_add_one(
 
         if (!(w = strdup(what)) ||
             !(o = strdup(options)) ||
+            !(s = strdup("/proc/self/mountinfo")) ||
             !(f = strdup(fstype))) {
                 r = -ENOMEM;
                 goto fail;
@@ -1558,6 +1559,8 @@ static int mount_add_one(
         }
 
         MOUNT(u)->from_proc_self_mountinfo = true;
+        free(u->source_path);
+        u->source_path = s;
 
         free(p->what);
         p->what = w;
@@ -1583,6 +1586,7 @@ static int mount_add_one(
 fail:
         free(w);
         free(o);
+        free(s);
         free(f);
 
         if (delete && u)
