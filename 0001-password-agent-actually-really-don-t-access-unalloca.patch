From 5ba7b871951ee120f1e9d5281debe00e2e42ba99 Mon Sep 17 00:00:00 2001
From: Lennart Poettering <lennart@poettering.net>
Date: Mon, 4 Jul 2011 19:06:32 +0200
Subject: [PATCH] password-agent: actually really don't access unallocated
 memory

Fix for 9726f9ff11fa7b94dceed2972cd2453a08b9ee6a
---
 src/tty-ask-password-agent.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/tty-ask-password-agent.c b/src/tty-ask-password-agent.c
index 38442f6..02b959e 100644
--- a/src/tty-ask-password-agent.c
+++ b/src/tty-ask-password-agent.c
@@ -384,9 +384,9 @@ static int parse_password(const char *filename, char **wall) {
                                         packet[0] = '+';
                                         strcpy(packet+1, password);
                                 }
-                        }
 
-                        free(password);
+                                free(password);
+                        }
                 }
 
                 if (r == -ETIME || r == -ENOENT) {
-- 
1.7.4.4

